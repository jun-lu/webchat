WE.userPage={};
WE.userPage.editAccount={init:function(){this.ui={itemWall:$("#edit-info").find(".edit-item"),nickNameWall:$("#nickname-wall"),desWall:$("#des-wall"),nameClose:$("#close-name"),nameSubmit:$("#submit-name"),desClose:$("#close-des"),desSubmit:$("#submit-des"),nameInput:$("#name-input"),desInput:$("#des-input")};this.regEvent()},regEvent:function(){var a=this;this.ui.nickNameWall.find(".display").click(function(){a.viewName()});this.ui.desWall.find(".display").click(function(){a.viewDes()});this.ui.nameClose.click(function(){a.hideName()});
this.ui.desClose.click(function(){a.hideDes()});this.ui.nameSubmit.click(function(){var b=$.trim(a.ui.nameInput.val());""!=b&&a.updateUserName(b)});this.ui.nameInput.keyup(function(b){13==b.keyCode&&a.ui.nameSubmit.click()});this.ui.desSubmit.click(function(){var b=$.trim(a.ui.desInput.val());""!=b&&a.updateUseDes(b)});this.ui.desInput.keyup(function(b){13==b.keyCode&&a.ui.desSubmit.click()})},viewName:function(){this.ui.nickNameWall.addClass("edit-item-select");this.ui.nickNameWall.find(".edit").removeClass("hidden");
this.ui.nickNameWall.find(".icon-user").removeClass("color-user-dark").addClass("color-user-white")},viewDes:function(){this.ui.desWall.addClass("edit-item-select");this.ui.desWall.find(".edit").removeClass("hidden");this.ui.desWall.find(".icon-list").addClass("color-list-white")},hideName:function(){this.ui.nickNameWall.removeClass("edit-item-select");this.ui.nickNameWall.find(".edit").addClass("hidden");this.ui.nickNameWall.find(".icon-user").addClass("color-user-dark").removeClass("color-user-white")},
hideDes:function(){this.ui.desWall.removeClass("edit-item-select");this.ui.desWall.find(".edit").addClass("hidden");this.ui.desWall.find(".icon-list").removeClass("color-list-white")},updateUserName:function(a){var b=this,c=new WE.api.UserModel,d=new WE.Controller;d.update=function(c){0==c.data.code&&(b.ui.nickNameWall.find(".display .info").text(a).removeClass("no-info"),b.hideName())};c.addObserver(d);c.updateUserName(a)},updateUseDes:function(a){var b=this,c=new WE.api.UserModel,d=new WE.Controller;
d.update=function(c){0==c.data.code&&(b.ui.desWall.find(".display .info").text(a).removeClass("no-info"),b.hideDes())};c.addObserver(d);c.updateUserSummery(a)}};
WE.userPage.editAvatar={init:function(){this.ui={submit:$("#avatar-submit"),radios:$("#select-item")};this.regEvent()},regEvent:function(){var a=this;this.ui.submit.click(function(){var b=a.ui.radios.find("input[type=radio]:checked").val();a.updateAvatar(b)})},updateAvatar:function(a){var b=new WE.api.UserModel,c=new WE.Controller;c.update=function(a){location.reload()};b.addObserver(c);b.updateAvator(a)}};
WE.userPage.bindMail={init:function(){this.ui={submit:$("#bindMail-submit"),input:$("#bindMail-input"),pwd:$("#pwd-input"),tips:$("#bindMail-tip")};this.regEvent()},regEvent:function(){var a=this;this.ui.submit.click(function(){var b=$.trim(a.ui.input.val()),c=$.trim(a.ui.pwd.val());""!=b&&""!=c&&(/^[^@]+@[^@]+$/.test(b)?a.updateMail(b,c):a.errorTip("Please enter a valid email"))})},updateMail:function(a,b){var c=this,d=new WE.api.UserModel,e=new WE.Controller;e.update=function(a){a=a.data;0==a.code?
(console.log("loaction",location),location.reload()):-2==a.code?c.errorTip("Email is exit! please try others"):-1==a.code?c.errorTip("Email format error"):c.errorTip(a.msg)};d.addObserver(e);d.updateMail(a,b)},errorTip:function(a){this.ui.tips.text(a).removeClass("hidden")}};
WE.userPage.home={tmpl:'<li>\t\t\t\t<div class="avatar pull-left">\t\t\t\t\t<a href="/user/<%=_id %>">\t\t\t\t\t\t<img src="<%=avatar %>">\t\t\t\t\t</a>\t\t\t\t</div>\t\t\t\t<div class="info pull-left">\t\t\t\t\t<a href="/user/<%=_id %>"><%= name == "" ? "(\u672a\u8bbe\u7f6e\u6635\u79f0)" : name %></a>\t\t\t\t\t<span><%=summary == "" ? "(No description)" : WE.kit.cutOff(summary,30)  %></span>\t\t\t\t</div>\t\t\t</li>',noTmpl:"<li>\t\t\t\t<span>No contects...</span>\t\t\t</li>",init:function(){this.ui=
{list:$("#contacts")};this.loadContacts()},loadContacts:function(){var a=this,b=new WE.api.UserModel,c=new WE.Controller;c.update=function(b){b=b.data;0==b.code&&(0<b.result.length?a.appends(b.result):$(a.noTmpl).appendTo(a.ui.list))};b.addObserver(c);b.getContactList()},appends:function(a){var b="",c=0;if(0<a.length){for(var d=a.length;c<d;c++)b+=WE.kit.tmpl(this.tmpl,a[c].to);$(b).appendTo(this.ui.list)}}};
